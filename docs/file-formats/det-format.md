# DET File Format - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ:** `.det`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–æ–≤ –¥–≤–∏–≥–∞—Ç–µ–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–≥–æ—Ä–∞–Ω–∏—è
**–ò—Å—Ç–æ—á–Ω–∏–∫:** EngMod4T simulation software (Delphi 7)
**–§–æ—Ä–º–∞—Ç:** Fixed-width ASCII text (**NOT** space-separated CSV)
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**üìñ –°–º. —Ç–∞–∫–∂–µ:** [EngMod4T Overview](../engmod4t-suite/engmod4t-overview.md) - Single Source of Truth –æ –ø—Ä–æ–≥—Ä–∞–º–º–µ-–∏—Å—Ç–æ—á–Ω–∏–∫–µ –∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Ñ–∞–π–ª–æ–≤.

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞

```
–°—Ç—Ä–æ–∫–∞ 1: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (NumCylinders, EngineType)
–°—Ç—Ä–æ–∫–∞ 2: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫ (24 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞)
–°—Ç—Ä–æ–∫–∞ 3+: –ú–∞—Ä–∫–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–æ–≤ ($1, $2...) + –¥–∞–Ω–Ω—ã–µ
```

---

## üìä –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞

```
‚Ññ  4 NATUR NumCyl
‚Üí  RPM  P-Av  Torque  PurCyl(1)  PurCyl(2)  PurCyl(3)  PurCyl(4)  ...
$1  1000  15.50  123.45  0.8500  0.8600  0.8700  0.8800  ...
$1  1500  22.30  150.20  0.8800  0.8700  0.8600  0.8500  ...
$2  1000  16.20  125.00  0.8700  0.8800  0.8900  0.8600  ...
```

---

## üîç –°—Ç—Ä–æ–∫–∞ 1: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

**–§–æ—Ä–º–∞—Ç:**
```
‚Ññ  <NumCylinders> <EngineType> NumCyl
```

**–ü—Ä–∏–º–µ—Ä:**
```
‚Ññ  4 NATUR NumCyl
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `‚Ññ` - —Å–ª—É–∂–µ–±–Ω—ã–π —Å–∏–º–≤–æ–ª (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)
- `NumCylinders` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏–ª–∏–Ω–¥—Ä–æ–≤ (4, 6, 8, 12)
- `EngineType` - —Ç–∏–ø –¥–≤–∏–≥–∞—Ç–µ–ª—è (`NATUR`, `TURBO`, `SUPER`)
- `NumCyl` - —Å–ª—É–∂–µ–±–Ω–∞—è –º–µ—Ç–∫–∞ (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è)

---

## üè∑Ô∏è –°—Ç—Ä–æ–∫–∞ 2: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫

**–§–æ—Ä–º–∞—Ç:**
```
‚Üí  RPM  P-Av  Torque  PurCyl(1)  PurCyl(2)  ...
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã (24 –∫–æ–ª–æ–Ω–∫–∏):**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ï–¥–∏–Ω–∏—Ü—ã | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|---------|----------|
| `RPM` | –æ–±/–º–∏–Ω | Simulated engine rpm |
| `P-Av` | –∫–í—Ç | Average engine total power over the last six cycles (kW) for a naturally aspirated engine. The same for a Supercharged engine but with the power absorbed by the Compressor and its drive subtracted. Average engine total power over the last forty cycles (kW) for a Turbocharged engine. |
| `Torque` | –ù¬∑–º | The engine torque calculated from the P-av value (Nm) |
| `PurCyl(1-4)` | - | Purity of the mixture in the cylinder at inlet valve closure |
| `TCylMax(1-4)` | ¬∞C | Maximum temperature per cylinder (¬∞C) |
| `PCylMax(1-4)` | –±–∞—Ä | Maximum pressure per cylinder (bar) |
| `TUbMax(1-4)` | ¬∞C | Maximum unburned mixture temperature per cylinder (¬∞C) |
| `Deto(1-4)` | - | The count of the number of detonations per cylinder over the last 4 cycles. 0 to 4. |
| `Convergence` | - | Convergence of the calculation (quality indicator) |

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –ü–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (‚Üí) —Å–ª—É–∂–µ–±–Ω–∞—è - –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ!

---

## üìà –°—Ç—Ä–æ–∫–∞ 3+: –î–∞–Ω–Ω—ã–µ —Ä–∞—Å—á—ë—Ç–æ–≤

**–§–æ—Ä–º–∞—Ç:**
```
<Marker>  <RPM>  <P-Av>  <Torque>  <PurCyl(1)>  ...
```

**–ü—Ä–∏–º–µ—Ä:**
```
$1  1000  15.50  123.45  0.8500  0.8600  ...
```

**–ú–∞—Ä–∫–µ—Ä—ã —Ä–∞—Å—á—ë—Ç–æ–≤:**
- –ü—Ä–æ—Å—Ç—ã–µ: `$1`, `$2`, `$3`
- –° —Ç–æ—á–∫–æ–π: `$3.1`, `$9.3`
- –°–ª–æ–∂–Ω—ã–µ: `$3.1 R 0.86`, `$2.1 0.86 _R`

**–°–∏–º–≤–æ–ª $:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞—á–∞–ª–æ –Ω–æ–≤–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞.

---

## üîÑ –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ JSON

**–ò—Å—Ö–æ–¥–Ω—ã–π .det —Ñ–∞–π–ª:**
```
‚Ññ  4 NATUR NumCyl
‚Üí  RPM  P-Av  Torque
$1  1000  15.50  123.45
$1  1500  22.30  150.20
```

**JSON –Ω–∞ –≤—ã—Ö–æ–¥–µ:**
```json
{
  "metadata": {
    "cylinders": 4,
    "engineType": "NATUR"
  },
  "calculations": [
    {
      "id": "$1",
      "name": "$1",
      "data": [
        { "RPM": 1000, "P-Av": 15.5, "Torque": 123.45 },
        { "RPM": 1500, "P-Av": 22.3, "Torque": 150.2 }
      ]
    }
  ]
}
```

---

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞

### 1. Fixed-width ASCII —Ñ–æ—Ä–º–∞—Ç (Delphi origin)

**–§–æ—Ä–º–∞—Ç:** Fixed-width ASCII text —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–±–µ–ª–∞–º–∏ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫.

**–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ:** –°–æ–∑–¥–∞–Ω Delphi 7 —á–µ—Ä–µ–∑ `WriteLn(F, Format('%12.2f ...', [values]))`.

**–ü–∞—Ä—Å–∏–Ω–≥:**
```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: Split –ø–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –ø—Ä–æ–±–µ–ª–∞–º
const values = line.trim().split(/\s+/).slice(1);  // slice(1) –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–≤—É—é –∫–æ–ª–æ–Ω–∫—É

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CSV –ø–∞—Ä—Å–µ—Ä –∏–ª–∏ split –ø–æ —Ç–∞–±–∞–º
const values = line.split(',');  // –ù–ï–¢! –≠—Ç–æ –Ω–µ CSV
const values = line.split(/\t+/);  // –ù–ï–¢! –≠—Ç–æ –Ω–µ —Ç–∞–±—ã
```

### 2. –°–ª—É–∂–µ–±–Ω–∞—è –ø–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–º–≤–æ–ª—ã `‚Ññ`, `‚Üí` –∏ –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–æ–∫.

**–†–µ—à–µ–Ω–∏–µ:** –ü–∞—Ä—Å–µ—Ä –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–µ—Ä–≤—É—é –∫–æ–ª–æ–Ω–∫—É –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ (`slice(1)`).

### 3. –°–ª–æ–∂–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∞—Ä–∫–µ—Ä—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã.

**–ü—Ä–∏–º–µ—Ä—ã:**
- `$3.1 R 0.86` ‚Üí id = "3.1 R 0.86"
- `$2.1 0.86 _R` ‚Üí id = "2.1 0.86 _R"

**–†–µ—à–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ —Å–∏–º–≤–æ–ª–∞ `$` –∫–∞–∫ id —Ä–∞—Å—á—ë—Ç–∞.

### 4. –ú–∞—Å—Å–∏–≤—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `PurCyl(1-4)` —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—é—Ç—Å—è –≤ 4 –∫–æ–ª–æ–Ω–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:** –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∏–º–µ–Ω–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ –º–∞—Å—Å–∏–≤.

```javascript
// –í —Ñ–∞–π–ª–µ:
PurCyl(1)  PurCyl(2)  PurCyl(3)  PurCyl(4)
0.85       0.86       0.87       0.88

// –í JSON:
"PurCyl": [0.85, 0.86, 0.87, 0.88]
```

### 5. –í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ (25-30).

**–†–µ—à–µ–Ω–∏–µ:** –ß–∏—Ç–∞–µ–º –¥–æ –∫–æ–Ω—Ü–∞ —Ñ–∞–π–ª–∞ –∏–ª–∏ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–∞—Ä–∫–µ—Ä–∞ `$`.

---

## üìÅ –ü—Ä–∏–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤

### Vesta 1.6 IM.det

- **–†–∞—Å—á—ë—Ç–æ–≤:** 17
- **–°—Ç—Ä–æ–∫:** 462
- **–ú–∞—Ä–∫–µ—Ä—ã:** $1, $2, $3, $3.1, $3.1 R 0.86, –∏ –¥—Ä.

### BMW M42.det

- **–†–∞—Å—á—ë—Ç–æ–≤:** 30
- **–°—Ç—Ä–æ–∫:** 804
- **–ú–∞—Ä–∫–µ—Ä—ã:** $1-$9, $9.1-$9.3

---

## üîó –°—Å—ã–ª–∫–∏

- [ADR 001: –ü–∞—Ä—Å–∏–Ω–≥ .det —Ñ–∞–π–ª–æ–≤](../decisions/001-det-file-format.md)
- [–ü–∞—Ä—Å–µ—Ä: backend/src/services/fileParser.js](../../backend/src/services/fileParser.js)
- [–¢–∏–ø—ã: shared-types.ts](../../shared-types.ts)
- [API: GET /api/project/:id](../api.md)
