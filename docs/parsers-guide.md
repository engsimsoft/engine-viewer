# üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –ø–∞—Ä—Å–µ—Ä–æ–≤

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 31 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0

---

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–æ–≤ –≤ Engine Results Viewer.

**–¢–µ–∫—É—â–∏–µ —Ñ–æ—Ä–º–∞—Ç—ã:**
- ‚úÖ [.det Format](file-formats/det-format.md) - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- ‚è≥ ~5 —Ñ–æ—Ä–º–∞—Ç–æ–≤ - –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–∏–Ω—Ü–∏–ø:** –í—Å–µ –ø–∞—Ä—Å–µ—Ä—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ **–µ–¥–∏–Ω—ã–π JSON —Ñ–æ—Ä–º–∞—Ç**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–Ω–∏–º–∞–µ—Ç frontend.

---

## üìã –ï–¥–∏–Ω—ã–π JSON —Ñ–æ—Ä–º–∞—Ç (—Ü–µ–ª–µ–≤–æ–π)

–í—Å–µ –ø–∞—Ä—Å–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "fileName": "BMW M42.det",
  "metadata": {
    "numCylinders": 4,
    "engineType": "NATUR"
  },
  "columnHeaders": [
    "RPM", "P-Av", "Torque", "PurCyl(1)", ...
  ],
  "calculations": [
    {
      "id": "$1",
      "name": "1",
      "dataPoints": [
        {
          "RPM": 1000,
          "P-Av": 15.5,
          "Torque": 123.45,
          "PurCyl": [0.85, 0.86, 0.87, 0.88],
          "TCylMax": [450, 452, 448, 451],
          "PCylMax": [45.2, 45.5, 45.1, 45.3],
          "TUbMax": [680, 685, 678, 682],
          "Deto": [0, 0, 0, 0],
          "Convergence": 0.0001
        }
      ]
    }
  ]
}
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- `fileName` - –∏–º—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- `metadata` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–≤–∏–≥–∞—Ç–µ–ª—è (cylinders, engineType, etc.)
- `calculations` - –º–∞—Å—Å–∏–≤ —Ä–∞—Å—á—ë—Ç–æ–≤
  - `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–∞—Å—á—ë—Ç–∞
  - `name` - –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è
  - `dataPoints` - –º–∞—Å—Å–∏–≤ —Ç–æ—á–µ–∫ –¥–∞–Ω–Ω—ã—Ö

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ dataPoints:**
- –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `RPM`, `P-Av`, `Torque`
- –ú–∞—Å—Å–∏–≤—ã –ø–æ —Ü–∏–ª–∏–Ω–¥—Ä–∞–º: `PurCyl`, `TCylMax`, `PCylMax`, `TUbMax`, `Deto`
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞

---

## üîß –®–∞–≥ 1: –ò–∑—É—á–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞

### 1.1. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã

–ü–æ–ø—Ä–æ—Å–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å 2-3 –ø—Ä–∏–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞.

**–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤:**
```
test-data/
‚îú‚îÄ‚îÄ example1.xyz  # –í–∞—à–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ example2.xyz
‚îî‚îÄ‚îÄ example3.xyz
```

### 1.2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É

**–í–æ–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:**
- –ö–∞–∫–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞? (`.xyz`)
- –¢–µ–∫—Å—Ç–æ–≤—ã–π –∏–ª–∏ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç?
- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏? (—Ç–∞–±—É–ª—è—Ü–∏—è, –∑–∞–ø—è—Ç—ã–µ, –ø—Ä–æ–±–µ–ª—ã)
- –ï—Å—Ç—å –ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫?
- –ö–∞–∫ –æ–±–æ–∑–Ω–∞—á–∞—é—Ç—Å—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ?
- –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã —Ä–∞—Å—á—ë—Ç—ã? (–º–∞—Ä–∫–µ—Ä—ã, —Å–µ–∫—Ü–∏–∏)
- –°–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫/–∑–∞–ø–∏—Å–µ–π –≤ —Ç–∏–ø–∏—á–Ω–æ–º —Ñ–∞–π–ª–µ?
- –ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç?

**–ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞ (.det —Ñ–æ—Ä–º–∞—Ç):**
```
‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ: .det
‚úÖ –§–æ—Ä–º–∞—Ç: –¢–µ–∫—Å—Ç–æ–≤—ã–π, —Ç–∞–±—É–ª—è—Ü–∏—è
‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
   - –°—Ç—Ä–æ–∫–∞ 1: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (cylinders, engineType)
   - –°—Ç—Ä–æ–∫–∞ 2: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫
   - –°—Ç—Ä–æ–∫–∞ 3+: –î–∞–Ω–Ω—ã–µ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ ($1, $2...)
‚úÖ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
   - –ü–µ—Ä–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–ª—É–∂–µ–±–Ω–∞—è (–Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏)
   - –ú–∞—Ä–∫–µ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º–∏ ($3.1 R 0.86)
   - –ú–∞—Å—Å–∏–≤—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (PurCyl(1-4))
```

### 1.3. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤ docs/

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `docs/file-formats/xyz-format.md`:

```markdown
# XYZ File Format - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ:** `.xyz`
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** [–û–ø–∏—Å–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö]

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞

[–ü–æ—Å—Ç—Ä–æ—á–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ]

## –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞

[–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–∑ test-data]

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞

[–ü—Ä–æ–±–ª–µ–º—ã –ø–∞—Ä—Å–∏–Ω–≥–∞, edge cases]
```

---

## üìù –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å ADR (Architecture Decision Record)

**–ó–∞—á–µ–º:** –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ü–û–ß–ï–ú–£ –≤—ã–±—Ä–∞–Ω–æ –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞.

### 2.1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª ADR

```bash
# –ù–æ–º–µ—Ä —Å–ª–µ–¥—É—é—â–∏–π –ø–æ –ø–æ—Ä—è–¥–∫—É (001 —É–∂–µ –∑–∞–Ω—è—Ç –¥–ª—è .det)
touch docs/decisions/002-xyz-file-format.md
```

### 2.2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ —à–∞–±–ª–æ–Ω—É

–ò—Å–ø–æ–ª—å–∑—É–π [docs/decisions/template.md](decisions/template.md).

**–ö–ª—é—á–µ–≤—ã–µ —Å–µ–∫—Ü–∏–∏ –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞:**
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –ó–∞—á–µ–º –Ω—É–∂–µ–Ω —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç? –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –Ω—ë–º?
- **–†–µ—à–µ–Ω–∏–µ:** –ö–∞–∫ –ø–∞—Ä—Å–∏—Ç—Å—è —Ñ–∞–π–ª? (–ø–æ—Å—Ç—Ä–æ—á–Ω–æ, regex, JSON.parse)
- **–ü—Ä–∏—á–∏–Ω—ã:** –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫? (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç–∞, –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å)
- **–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:** –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç? –ö–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è?
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:** –ö–∞–∫–∏–µ –ø–æ–¥—Ö–æ–¥—ã —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏—Å—å? –ü–æ—á–µ–º—É –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã?
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** –°—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–¥ –ø–∞—Ä—Å–µ—Ä–∞

**–ü—Ä–∏–º–µ—Ä ADR:** [docs/decisions/001-det-file-format.md](decisions/001-det-file-format.md)

---

## üíª –®–∞–≥ 3: –ù–∞–ø–∏—Å–∞—Ç—å –ø–∞—Ä—Å–µ—Ä

### 3.1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –ø–∞—Ä—Å–µ—Ä–∞

**–í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –±—É–¥—É—â–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤)**

```bash
touch backend/src/services/parsers/xyzParser.js
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –í fileParser.js (—Ç–µ–∫—É—â–∏–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è .det)**

–§—É–Ω–∫—Ü–∏–∏ –≤ `backend/src/services/fileParser.js`.

### 3.2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞—Ä—Å–µ—Ä–∞

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**

```javascript
/**
 * –ü–∞—Ä—Å–∏—Ç .xyz —Ñ–∞–π–ª
 * @param {string} filePath - –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
 * @returns {Promise<Object>} - –û–±—ä–µ–∫—Ç –≤ –µ–¥–∏–Ω–æ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ
 */
async function parseXyzFile(filePath) {
  try {
    // 1. –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª
    const content = await readFile(filePath, 'utf-8');

    // 2. –†–∞–∑–±–∏—Ç—å –Ω–∞ —Å—Ç—Ä–æ–∫–∏/—Å–µ–∫—Ü–∏–∏
    const lines = content.split('\n');

    // 3. –ü–∞—Ä—Å–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    const metadata = parseMetadata(lines[0]);

    // 4. –ü–∞—Ä—Å–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    const columnHeaders = parseColumnHeaders(lines[1]);

    // 5. –ü–∞—Ä—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
    const calculations = parseCalculations(lines.slice(2), metadata);

    // 6. –í–µ—Ä–Ω—É—Ç—å –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    return {
      fileName: basename(filePath),
      metadata,
      columnHeaders,
      calculations
    };
  } catch (error) {
    console.error(`–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ ${filePath}:`, error);
    throw error;
  }
}

/**
 * –ü–∞—Ä—Å–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (—Å—Ç—Ä–æ–∫–∞ 1)
 */
function parseMetadata(line) {
  // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
  return {
    numCylinders: 4,
    engineType: 'NATUR'
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
  };
}

/**
 * –ü–∞—Ä—Å–∏—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∫–æ–ª–æ–Ω–æ–∫
 */
function parseColumnHeaders(line) {
  // –†–∞–∑–±–∏—Ç—å –ø–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º
  return line.split('\t').filter(Boolean);
}

/**
 * –ü–∞—Ä—Å–∏—Ç —Ä–∞—Å—á—ë—Ç—ã –∏ –¥–∞–Ω–Ω—ã–µ
 */
function parseCalculations(lines, metadata) {
  const calculations = [];
  let currentCalculation = null;

  for (const line of lines) {
    // –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–∞ —Ä–∞—Å—á—ë—Ç–∞
    if (isCalculationMarker(line)) {
      if (currentCalculation) {
        calculations.push(currentCalculation);
      }
      currentCalculation = {
        id: extractCalculationId(line),
        name: extractCalculationName(line),
        dataPoints: []
      };
    } else if (currentCalculation) {
      // –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
      const dataPoint = parseDataLine(line, metadata);
      if (dataPoint) {
        currentCalculation.dataPoints.push(dataPoint);
      }
    }
  }

  // –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞—Å—á—ë—Ç
  if (currentCalculation) {
    calculations.push(currentCalculation);
  }

  return calculations;
}

/**
 * –ü–∞—Ä—Å–∏—Ç –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É –¥–∞–Ω–Ω—ã—Ö
 */
function parseDataLine(line, metadata) {
  const values = line.split('\t').filter(Boolean);

  return {
    RPM: parseFloat(values[0]),
    'P-Av': parseFloat(values[1]),
    Torque: parseFloat(values[2]),
    PurCyl: parseArrayValues(values, 3, metadata.numCylinders),
    TCylMax: parseArrayValues(values, 3 + metadata.numCylinders, metadata.numCylinders),
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
  };
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
export { parseXyzFile };
```

### 3.3. –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

**‚úÖ DO:**
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å edge cases (–ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏, –Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏ (`console.error`)
- –ë—Ä–æ—Å–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
- –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TypeScript JSDoc –¥–ª—è —Ç–∏–ø–æ–≤

**‚ùå DON'T:**
- –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏ (`try/catch` –±–µ–∑ –¥–µ–π—Å—Ç–≤–∏–π)
- –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞—Ç—å —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- –•–∞—Ä–¥–∫–æ–¥–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `metadata.numCylinders`)
- –ü–∞—Ä—Å–∏—Ç—å –≤–µ—Å—å —Ñ–∞–π–ª –≤ –ø–∞–º—è—Ç—å (–µ—Å–ª–∏ —Ñ–∞–π–ª >100MB)
- –ò–∑–º–µ–Ω—è—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üîå –®–∞–≥ 4: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—Å–µ—Ä

### 4.1. –û–±–Ω–æ–≤–∏—Ç—å config.yaml

–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤ `config.yaml`:

```yaml
files:
  extensions:
    - '.det'
    - '.xyz'  # ‚Üê –ù–æ–≤–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
  maxSize: 10485760  # 10 MB
```

### 4.2. –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ—É—Ç—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–ï—Å–ª–∏ –ø–∞—Ä—Å–µ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ:**

–û–±–Ω–æ–≤–∏—Ç—å `backend/src/routes/data.js`:

```javascript
import { parseDetFile } from '../services/fileParser.js';
import { parseXyzFile } from '../services/parsers/xyzParser.js';

// –í —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–æ—É—Ç–∞:
let projectData;
if (filePath.endsWith('.det')) {
  projectData = await parseDetFile(filePath);
} else if (filePath.endsWith('.xyz')) {
  projectData = await parseXyzFile(filePath);
} else {
  throw new Error('Unsupported file format');
}
```

**–õ—É—á—à–µ: –°–æ–∑–¥–∞—Ç—å —Ñ–∞–±—Ä–∏–∫—É –ø–∞—Ä—Å–µ—Ä–æ–≤:**

```javascript
// backend/src/services/parserFactory.js
import { parseDetFile } from './fileParser.js';
import { parseXyzFile } from './parsers/xyzParser.js';

const PARSERS = {
  '.det': parseDetFile,
  '.xyz': parseXyzFile
};

export function getParser(filePath) {
  const ext = path.extname(filePath).toLowerCase();
  const parser = PARSERS[ext];

  if (!parser) {
    throw new Error(`No parser found for extension: ${ext}`);
  }

  return parser;
}

export async function parseFile(filePath) {
  const parser = getParser(filePath);
  return await parser(filePath);
}
```

–û–±–Ω–æ–≤–∏—Ç—å `routes/data.js`:

```javascript
import { parseFile } from '../services/parserFactory.js';

// –í —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–æ—É—Ç–∞:
const projectData = await parseFile(filePath);
```

---

## ‚úÖ –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 5.1. Unit —Ç–µ—Å—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–°–æ–∑–¥–∞—Ç—å `backend/tests/parsers/xyzParser.test.js`:

```javascript
import { parseXyzFile } from '../../src/services/parsers/xyzParser.js';
import { describe, it, expect } from 'vitest';

describe('XYZ Parser', () => {
  it('should parse valid XYZ file', async () => {
    const result = await parseXyzFile('test-data/example.xyz');

    expect(result).toHaveProperty('fileName');
    expect(result).toHaveProperty('metadata');
    expect(result).toHaveProperty('calculations');
    expect(result.calculations).toBeInstanceOf(Array);
  });

  it('should handle metadata correctly', async () => {
    const result = await parseXyzFile('test-data/example.xyz');

    expect(result.metadata.numCylinders).toBe(4);
    expect(result.metadata.engineType).toBe('NATUR');
  });

  it('should throw error for invalid file', async () => {
    await expect(
      parseXyzFile('test-data/invalid.xyz')
    ).rejects.toThrow();
  });
});
```

### 5.2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

1. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π `.xyz` —Ñ–∞–π–ª –≤ `test-data/`
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å backend:
   ```bash
   ./scripts/start.sh
   ```
3. –û—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä:
   ```
   http://localhost:5173
   ```
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - –§–∞–π–ª –ø–æ—è–≤–∏–ª—Å—è –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–æ–µ–∫—Ç–æ–≤
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
   - –ì—Ä–∞—Ñ–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ DevTools:**

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
fetch('http://localhost:3000/api/projects')
  .then(r => r.json())
  .then(data => console.log(data));

fetch('http://localhost:3000/api/project/example-xyz')
  .then(r => r.json())
  .then(data => console.log(data));
```

### 5.3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞:**

```javascript
// –í routes/data.js —É–∂–µ –µ—Å—Ç—å —Ç–∞–π–º–µ—Ä:
const startTime = Date.now();
const projectData = await parseFile(filePath);
const parseDuration = Date.now() - startTime;

console.log(`Parse duration: ${parseDuration}ms`);
```

**–¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**
- –§–∞–π–ª <1 MB: <50ms
- –§–∞–π–ª 1-5 MB: <200ms
- –§–∞–π–ª 5-10 MB: <500ms

**–ï—Å–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–æ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å stream parsing (–¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤)
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

## üìö –®–∞–≥ 6: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### 6.1. –û–±–Ω–æ–≤–∏—Ç—å docs/file-formats/README.md

–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü—É:

```markdown
| –§–æ—Ä–º–∞—Ç | –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞—Ä—Å–µ—Ä | ADR | –°—Ç–∞—Ç—É—Å |
|--------|-----------|----------|--------|-----|--------|
| **DET** | `.det` | –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–æ–≤ | `detParser.js` | [ADR 001](decisions/001-det-file-format.md) | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| **XYZ** | `.xyz` | [–û–ø–∏—Å–∞–Ω–∏–µ] | `xyzParser.js` | ADR 002 (–ø—Ä–∏–º–µ—Ä) | ‚è≥ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |
```

### 6.2. –û–±–Ω–æ–≤–∏—Ç—å README.md

–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –≤ —Å–µ–∫—Ü–∏—é "Supported Formats".

### 6.3. –û–±–Ω–æ–≤–∏—Ç—å CHANGELOG.md

```markdown
## [Unreleased]

### Added
- Support for .xyz file format
- Parser: `xyzParser.js`
- Documentation: `docs/file-formats/xyz-format.md`
- ADR 002: XYZ file format parsing decision

### Changed
- Updated file format table in README.md
- Extended `config.yaml` with .xyz extension
```

### 6.4. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã

–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ `docs/file-formats/examples/`:

```
docs/file-formats/examples/
‚îú‚îÄ‚îÄ sample.det       # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π
‚îî‚îÄ‚îÄ sample.xyz       # –ù–æ–≤—ã–π
```

---

## üîç Checklist: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞

–ò—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç —á–µ–∫–ª–∏—Å—Ç –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
- [ ] –ü–æ–ª—É—á–∏–ª —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã (2-3 –ø—Ä–∏–º–µ—Ä–∞)
- [ ] –°–æ—Ö—Ä–∞–Ω–∏–ª –≤ `test-data/`
- [ ] –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞
- [ ] –ò–∑—É—á–∏–ª –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º–∞—Ç–∞ (edge cases)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –°–æ–∑–¥–∞–ª ADR: `docs/decisions/00X-format-name.md`
- [ ] –°–æ–∑–¥–∞–ª –æ–ø–∏—Å–∞–Ω–∏–µ: `docs/file-formats/format-name.md`
- [ ] –û–±–Ω–æ–≤–∏–ª `docs/file-formats/README.md`
- [ ] –î–æ–±–∞–≤–∏–ª –ø—Ä–∏–º–µ—Ä—ã –≤ `docs/file-formats/examples/`

### –ö–æ–¥
- [ ] –°–æ–∑–¥–∞–ª –ø–∞—Ä—Å–µ—Ä: `backend/src/services/parsers/formatParser.js`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–ª `parseFormatFile()` —Ñ—É–Ω–∫—Ü–∏—é
- [ ] –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –µ–¥–∏–Ω–æ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∞–Ω—ã –æ—à–∏–±–∫–∏ –∏ edge cases

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –û–±–Ω–æ–≤–∏–ª `config.yaml` (–¥–æ–±–∞–≤–∏–ª —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ)
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–ª –≤ `parserFactory.js` (–∏–ª–∏ `routes/data.js`)
- [ ] –ü–∞—Ä—Å–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è —Ñ–∞–π–ª–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ù–∞–ø–∏—Å–∞–ª unit —Ç–µ—Å—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ñ–∞–π–ª –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –≥—Ä–∞—Ñ–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–≤—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞)

### –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
- [ ] –û–±–Ω–æ–≤–∏–ª README.md (—Å–µ–∫—Ü–∏—è Supported Formats)
- [ ] –û–±–Ω–æ–≤–∏–ª CHANGELOG.md ([Unreleased] —Å–µ–∫—Ü–∏—è)
- [ ] –°–¥–µ–ª–∞–ª –∫–æ–º–º–∏—Ç —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –≤ Chrome –∏ Safari

---

## üîó –°—Å—ã–ª–∫–∏

### –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∏–º–µ—Ä—ã
- [.det Parser](../backend/src/services/fileParser.js) - –†–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä –ø–∞—Ä—Å–µ—Ä–∞
- [ADR 001: DET Format](decisions/001-det-file-format.md) - –ü—Ä–∏–º–µ—Ä ADR
- [DET Format Spec](file-formats/det-format.md) - –ü—Ä–∏–º–µ—Ä –æ–ø–∏—Å–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- [ADR Template](decisions/template.md) - –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö ADR

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- [README.md](../README.md) - –ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Architecture](architecture.md) - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [API Documentation](api.md) - REST API endpoints

---

**–ì–æ—Ç–æ–≤–æ! –°–ª–µ–¥—É–π —ç—Ç–æ–º—É —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–æ–≤.** üöÄ
