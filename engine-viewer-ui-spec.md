# 🎨 Engine Viewer - UI/UX Specification

**Версия:** 2.0  
**Дата:** 22 октября 2025  
**Дополнение к:** TECH_SPEC.md

---

## 📊 Контекст масштаба проекта

### Реальное использование

**Количество данных:**
- Десятки проектов (10-50+ файлов `.det`)
- В каждом проекте до 20+ расчётов
- Каждый расчёт содержит 20-30 точек данных (RPM от 2600 до 7800)

**Формат маркеров расчётов:**
- Маркер = `$` + ЛЮБОЙ текст (что угодно!)
- Примеры: `$1`, `$BMW M42 14 UpDate`, `$20.1`, `$привет`, `$final version`
- Пользователь сам определяет названия
- Никакой предустановленной структуры или логики

---

## 📁 Метаданные проектов

### Концепция

**Проблема:** Backend присылает только название файла (`Vesta 1.6 IM.det`). При десятках проектов трудно вспомнить о чём каждый проект.

**Решение:** Пользователь может добавить описание проекта с метаданными:
- Описание (что это за проект?)
- Заказчик / Владелец (кто заказал?)
- Теги (категории для фильтрации)
- Заметки (важная информация)
- Статус (в работе / завершён / архив)
- Цвет метки (опционально)

**Хранение:** JSON файлы в папке `.metadata/` (рядом с `.det` файлами)

### Структура данных

```typescript
interface ProjectMetadata {
  projectId: string;           // "Vesta 1.6 IM" (из имени файла)
  description: string;         // Описание проекта
  client: string;              // Заказчик
  tags: string[];              // ["Серийное", "Атмосферник", "EURO-5"]
  notes: string;               // Заметки
  status: 'active' | 'completed' | 'archived';
  color?: string;              // Цвет метки HEX (#3b82f6)
  createdAt: string;           // ISO дата создания записи
  updatedAt: string;           // ISO дата последнего изменения
}
```

### Хранение

**Файловая структура:**
```
engine-results-viewer/
├── test-data/
│   ├── Vesta 1.6 IM.det
│   ├── BMW M42.det
│   ├── Porsche 924.det
│   └── .metadata/            ← Папка с метаданными
│       ├── Vesta 1.6 IM.json
│       ├── BMW M42.json
│       └── Porsche 924.json
```

**Пример файла `.metadata/Vesta 1.6 IM.json`:**
```json
{
  "projectId": "Vesta 1.6 IM",
  "description": "Лада Веста 1.6 литра атмосферный двигатель для серийного производства АвтоВАЗ. Оптимизация под EURO-5.",
  "client": "АвтоВАЗ",
  "tags": ["Серийное", "Атмосферник", "EURO-5"],
  "notes": "Финальные расчёты перед запуском в производство. Проверить $20.1",
  "status": "completed",
  "color": "#3b82f6",
  "createdAt": "2024-10-01T10:00:00Z",
  "updatedAt": "2024-11-01T15:30:00Z"
}
```

### Backend API (добавить)

**GET /api/projects/:id/metadata**
- Получить метаданные проекта
- Вернуть JSON или 404 если файла нет

**POST /api/projects/:id/metadata**
- Сохранить метаданные
- Создать/обновить файл `.metadata/{projectId}.json`

**DELETE /api/projects/:id/metadata**
- Удалить метаданные
- Удалить файл `.metadata/{projectId}.json`

---

## 🏠 Главная страница (список проектов)

### Два режима отображения

**📋 Режим "Список"** - компактный (для быстрой навигации)  
**🎴 Режим "Карточки"** - с метаданными (для обзора)

Переключение между режимами в header.

### Layout: Режим "Карточки" (по умолчанию)

```
┌─────────────────────────────────────────────────────────────┐
│ 🔍 [Поиск...]  📋 Список  🎴 Карточки  Теги:[Все▼]  [+]    │
├─────────────────────────────────────────────────────────────┤
│ Сортировка: [По дате ▼]    Статус: [Все ▼]                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│ ┌────────────────────────┐  ┌────────────────────────┐      │
│ │ 📊 Vesta 1.6 IM    ✅ │  │ 📊 BMW M42        🔧  │      │
│ │ ────────────────────────│  │ ────────────────────────│      │
│ │ Лада Веста 1.6л атмо   │  │ BMW M42 турбо тюнинг   │      │
│ │ для серийного          │  │ Stage 2 проект         │      │
│ │ производства АвтоВАЗ   │  │                         │      │
│ │                         │  │                         │      │
│ │ 👤 АвтоВАЗ              │  │ 👤 Частный заказ       │      │
│ │ 🏷️ Серийное, EURO-5    │  │ 🏷️ Тюнинг, Спорт      │      │
│ │                         │  │                         │      │
│ │ 3 расчёта | 01/11/2024 │  │ 18 расчётов | 26/10/24│      │
│ │                         │  │                         │      │
│ │ [Открыть] [✏️ Править] │  │ [Открыть] [✏️ Править] │      │
│ └────────────────────────┘  └────────────────────────┘      │
│                                                              │
│ ┌────────────────────────┐  ┌────────────────────────┐      │
│ │ 📊 Porsche 924         │  │ 📊 4RACING 1600   ✅  │      │
│ │ ────────────────────────│  │ ────────────────────────│      │
│ │ (без описания)         │  │ Гоночный мотор 1.6     │      │
│ │                         │  │ для Formula Student    │      │
│ │                         │  │                         │      │
│ │ 5 расчётов             │  │ 👤 4Racing Team        │      │
│ │ 📅 03/12/2024          │  │ 🏷️ Гонки, Спорт       │      │
│ │                         │  │                         │      │
│ │ [Открыть] [✏️ Править] │  │ 7 расчётов | 27/11/24 │      │
│ │                         │  │                         │      │
│ │                         │  │ [Открыть] [✏️ Править] │      │
│ └────────────────────────┘  └────────────────────────┘      │
└─────────────────────────────────────────────────────────────┘
```

**Иконки статуса:**
- 🔧 В работе (active)
- ✅ Завершён (completed)
- 📦 Архив (archived)

**Элементы карточки:**
- Название проекта + иконка статуса
- Описание (первые 2 строки, обрезать если длиннее)
- Заказчик (👤 иконка)
- Теги (🏷️ иконка, максимум 3 тега видимых)
- Количество расчётов + дата изменения
- Кнопки: "Открыть" (основная) + "✏️ Править" (иконка)

**Если нет метаданных:**
- Показать "(без описания)"
- Только название + количество расчётов + дата

### Layout: Режим "Список"

```
┌─────────────────────────────────────────────────────────────┐
│ 🔍 [Поиск...]  📋 Список  🎴 Карточки  Теги:[Все▼]  [+]    │
├─────────────────────────────────────────────────────────────┤
│ Сортировка: [По дате ▼]    Статус: [Все ▼]                 │
├─────────────────────────────────────────────────────────────┤
│ Название              Описание         Клиент    Расчётов   │
├─────────────────────────────────────────────────────────────┤
│ 📊 Vesta 1.6 IM ✅   Лада Веста атмо  АвтоВАЗ      3       │
│ 📊 BMW M42 🔧        BMW M42 турбо    Частный     18       │
│ 📊 Porsche 924       -                -            5       │
│ 📊 4RACING 1600 ✅   Гоночный мотор   4Racing      7       │
│ ...                                                          │
└─────────────────────────────────────────────────────────────┘
```

**Компактный вид:**
- Одна строка на проект
- Показывать только ключевую информацию
- Быстрый скролл и навигация

### Функции главной страницы

**1. Поиск (расширенный):**
- Поиск по:
  - Название проекта
  - Описание
  - Заказчик
  - Теги
  - Заметки
- Live search (фильтрация при вводе)
- Case-insensitive

**Примеры поиска:**
```
Ввод "АвтоВАЗ" → найдёт проекты:
  - С "АвтоВАЗ" в названии
  - С "АвтоВАЗ" в описании
  - С "АвтоВАЗ" в поле заказчик
  
Ввод "тюнинг" → найдёт проекты с тегом "Тюнинг"
```

**2. Фильтр по тегам:**
- Dropdown со всеми уникальными тегами
- Показать количество проектов для каждого тега
- Можно выбрать несколько тегов (AND логика)

**Пример:**
```
Теги: [Все ▼]
├─ Все проекты (14)
├─ Тюнинг (5)
├─ Серийное (3)
├─ Гонки (2)
├─ Спорт (4)
└─ EURO-5 (2)
```

**3. Фильтр по статусу:**
```
Статус: [Все ▼]
├─ Все (14)
├─ 🔧 В работе (6)
├─ ✅ Завершён (5)
└─ 📦 Архив (3)
```

**4. Сортировка:**
- По дате (новые сверху) - по умолчанию
- По имени (A-Z)
- По количеству расчётов (больше → меньше)
- По статусу

**5. Кнопка "+" (создать описание):**
- Открывает диалог редактирования
- Можно создать метаданные для проекта, который уже есть

**6. Пустое состояние:**
```
┌─────────────────────────────────────┐
│                                      │
│        📂                            │
│   Нет проектов                      │
│                                      │
│   Добавьте файлы .det в папку:     │
│   ./test-data/                      │
│                                      │
└─────────────────────────────────────┘
```

---

## ✏️ Диалог редактирования метаданных

### Открытие диалога

**Способы открыть:**
1. Клик на "✏️ Править" на карточке проекта
2. Клик на кнопку "+" в header
3. Правый клик на проект → "Редактировать описание"

### UI диалога

```
┌──────────────────────────────────────────────────────┐
│ Редактирование проекта: Vesta 1.6 IM          [✕]   │
├──────────────────────────────────────────────────────┤
│                                                       │
│ Название проекта:                                    │
│ ┌────────────────────────────────────────┐          │
│ │ Vesta 1.6 IM                           │ (readonly)│
│ └────────────────────────────────────────┘          │
│ Из файла, нельзя изменить                           │
│                                                       │
│ Описание:                                            │
│ ┌────────────────────────────────────────┐          │
│ │ Лада Веста 1.6 литра атмосферный      │          │
│ │ двигатель для серийного производства   │          │
│ │ АвтоВАЗ. Оптимизация под EURO-5.      │          │
│ └────────────────────────────────────────┘          │
│ Максимум 500 символов                               │
│                                                       │
│ Заказчик / Владелец:                                │
│ ┌────────────────────────────────────────┐          │
│ │ АвтоВАЗ                                │          │
│ └────────────────────────────────────────┘          │
│                                                       │
│ Теги:                                                │
│ ┌──────┐ ┌──────────┐ ┌────────┐                   │
│ │Серийное│ │Атмосферник│ │EURO-5 │ [+ Добавить]   │
│ │   ✕   │ │    ✕     │ │   ✕   │                   │
│ └──────┘ └──────────┘ └────────┘                   │
│ Нажмите ✕ чтобы удалить тег                        │
│                                                       │
│ Заметки:                                             │
│ ┌────────────────────────────────────────┐          │
│ │ Финальные расчёты перед запуском в    │          │
│ │ производство. Проверить $20.1         │          │
│ └────────────────────────────────────────┘          │
│ Для личных заметок (не показываются на карточке)    │
│                                                       │
│ Статус:                                              │
│ ○ 🔧 В работе  ● ✅ Завершён  ○ 📦 Архив          │
│                                                       │
│ Цвет метки: (опционально)                           │
│ 🔴 🟠 🟡 🟢 🔵 🟣 ⚫ ⚪ [Без цвета]                  │
│                                                       │
│               [Сохранить]  [Отмена]                  │
└──────────────────────────────────────────────────────┘
```

### Поля

**1. Название проекта (readonly):**
- Берётся из имени файла `.det`
- Нельзя изменить (серый фон)
- Показать подсказку: "Из файла, нельзя изменить"

**2. Описание (textarea):**
- Многострочное поле
- Максимум 500 символов
- Показать счётчик символов: "250 / 500"
- Placeholder: "Опишите проект..."

**3. Заказчик (input):**
- Одна строка
- Максимум 100 символов
- Placeholder: "Кто заказчик или владелец?"

**4. Теги (tag input):**
- Можно добавлять неограниченно
- Клик "✕" → удалить тег
- Кнопка "+ Добавить" → показать input для нового тега
- Enter → добавить тег
- Теги сохраняются в lowercase для унификации

**5. Заметки (textarea):**
- Многострочное поле
- Максимум 1000 символов
- Для личных заметок
- Не показываются на карточке проекта
- Placeholder: "Дополнительная информация..."

**6. Статус (radio buttons):**
- 3 варианта: В работе / Завершён / Архив
- С иконками для наглядности
- По умолчанию: "В работе"

**7. Цвет метки (опционально):**
- 8 предустановленных цветов
- Кнопка "Без цвета" (по умолчанию)
- Используется для визуального выделения на карточке

### Поведение

**Сохранение:**
1. Клик "Сохранить"
2. Валидация (хотя бы описание должно быть заполнено)
3. POST /api/projects/:id/metadata
4. Закрыть диалог
5. Обновить карточку проекта на главной

**Отмена:**
- Клик "Отмена" или [✕]
- Спросить подтверждение если есть несохранённые изменения
- Закрыть диалог

**Удаление метаданных:**
- Кнопка "Удалить описание" внизу диалога (опционально)
- Подтверждение: "Удалить все метаданные? Это действие нельзя отменить."
- DELETE /api/projects/:id/metadata
- Закрыть диалог

---

## 📈 Страница визуализации

### Layout

**Без изменений, как в предыдущей версии:**

```
┌────────────────────────────────────────────────────────────────────┐
│ ← Назад      BMW M42 (18 расчётов)              [⚙️] [❓]         │
├──────────────┬─────────────────────────────────────────────────────┤
│              │                                                      │
│  РАСЧЁТЫ     │                                                      │
│  (макс. 5)   │                                                      │
│              │                ГРАФИК                               │
│ 🔍 [Поиск]   │           (ECharts здесь)                           │
│              │                                                      │
│ [Все ▼]      │                                                      │
│ Выбрано 2/5  │                                                      │
│              │                                                      │
│ ☑ $20    ⚫  │                                                      │
│ ☑ $20.1  ⚫  │                                                      │
│ ☐ $20.2  ⚪  │                                                      │
│ ...          │                                                      │
│              │                                                      │
│──────────────│                                                      │
│  ПРЕСЕТЫ     │                                                      │
│ [💪 Мощность]│                                                      │
│ [⚡ Давление]│                                                      │
│ [🔥 Темп-ра] │                                                      │
│ [⚙️ Кастом]  │                                                      │
│──────────────│                                                      │
│ [💾 Экспорт] │                                                      │
├──────────────┴─────────────────────────────────────────────────────┤
│                        ТАБЛИЦА ДАННЫХ                               │
└────────────────────────────────────────────────────────────────────┘
```

**Единственное изменение:**  
Кнопка "← Назад" возвращает на главную с сохранением фильтров/режима просмотра.

---

## 🎯 Селектор расчётов

**Без изменений, как в предыдущей версии:**

```
┌──────────────────────────────────────┐
│ 🔍 Поиск: [________________]        │
│                                      │
│ Показать: [Все ▼] Выбрано: 2/5     │
├──────────────────────────────────────┤
│ ☐ $14 UpDate              ⚪        │
│ ☐ $15                     ⚪        │
│ ☑ $20                     ⚫        │
│ ☑ $20.1                   ⚫        │
│ ☐ $20.2                   ⚪        │
│ ...                               │
└──────────────────────────────────────┘
```

---

## 🎛️ Пресеты графиков

**Без изменений, как в предыдущей версии.**

### Пресет 1: Мощность и момент
- P-Av + Torque vs RPM

### Пресет 2: Давление в цилиндрах
- PCylMax(1-4) vs RPM

### Пресет 3: Температурный режим
- TCylMax + TUbMax vs RPM

### Пресет 4: Кастом
- Пользователь выбирает параметры

---

## 📊 График (ECharts)

**Без изменений, как в предыдущей версии.**

Обязательные функции:
- Zoom, Pan, Tooltip
- Slider для выбора диапазона
- Легенда с возможностью скрыть линии
- Toolbox (экспорт PNG/SVG)

---

## 📋 Таблица данных

**Без изменений, как в предыдущей версии.**

Функции:
- Фильтр по расчёту
- Сортировка по колонкам
- Поиск
- Экспорт CSV

---

## 🚨 Обработка ошибок

**Без изменений, как в предыдущей версии.**

Понятные сообщения с возможностью показать технические детали.

---

## 🎨 Цветовая схема

**Без изменений, как в предыдущей версии.**

```yaml
colors:
  background: "#f9fafb"
  surface: "#ffffff"
  text_primary: "#111827"
  text_secondary: "#6b7280"
  primary: "#3b82f6"
  border: "#e5e7eb"
  
  calculation_1: "#ff6b6b"
  calculation_2: "#4ecdc4"
  calculation_3: "#45b7d1"
  calculation_4: "#f9ca24"
  calculation_5: "#a29bfe"
```

---

## 🔍 Парсинг маркеров расчётов

**Без изменений, как в предыдущей версии.**

Маркер = `$` + ЛЮБОЙ текст (что угодно!)

```javascript
function parseCalculationMarker(line) {
  const parts = line.trim().split(/\s+/);
  const content = parts.slice(1).join(' ');
  
  if (!content.startsWith('$')) return null;
  
  return {
    id: content,
    name: content
  };
}
```

---

## 🚀 Workflow пользователя

### Сценарий 1: Первое использование проекта (без метаданных)

```
1. Запустили приложение
2. Видим список проектов (режим карточек)
3. "Vesta 1.6 IM" показывается без описания
4. Клик "✏️ Править" → диалог редактирования
5. Заполнили:
   - Описание: "Лада Веста 1.6л атмо..."
   - Заказчик: "АвтоВАЗ"
   - Теги: "Серийное", "EURO-5"
   - Статус: "Завершён"
6. Сохранили
7. Карточка обновилась, теперь с описанием!
```

### Сценарий 2: Поиск проекта по описанию

```
1. Вводим в поиск: "АвтоВАЗ"
2. Находим все проекты где:
   - В названии есть "АвтоВАЗ"
   - В описании есть "АвтоВАЗ"
   - В заказчике есть "АвтоВАЗ"
3. Результат: "Vesta 1.6 IM"
```

### Сценарий 3: Фильтрация по тегам

```
1. Выбрали фильтр "Теги: Тюнинг"
2. Показываются только проекты с тегом "Тюнинг"
3. Результат: "BMW M42", "Porsche 924"
```

### Сценарий 4: Работа со статусом

```
1. Проект завершён → ставим статус "Завершён" ✅
2. На карточке появляется иконка ✅
3. Можно фильтровать: "Статус: Завершён"
4. Видим только завершённые проекты
```

### Сценарий 5: Быстрое открытие (как раньше)

```
1. Главная → клик на "BMW M42" → [Открыть]
2. Клик на пресет "💪 Мощность"
3. График отображается (2 клика, ~5 секунд)
```

---

## 📊 Сравнение с Post4t

| Аспект | Post4t (текущий) | Engine Viewer (новый) |
|--------|------------------|----------------------|
| **Workflow** | 5 шагов, 1-2 минуты | 2 клика, 5 секунд |
| **UI стиль** | Windows 95 | Modern 2025 |
| **Описание проектов** | Нет | ✅ Да (метаданные) |
| **Превью проектов** | Нет | ✅ Да (карточки/список) |
| **Поиск проектов** | Нет | ✅ Да (+ по метаданным) |
| **Фильтры** | Нет | ✅ Да (теги, статус) |
| **Организация** | Только файлы | ✅ Теги, статусы |
| **Выбор расчётов** | Скролл списка | ✅ Поиск + чекбоксы |
| **Пресеты** | Нет | ✅ 4 готовых |
| **График** | Базовый | ✅ Интерактивный |
| **Сравнение** | Непонятно | ✅ Цветные метки |
| **Таблица** | Нет | ✅ Да (с экспортом) |

---

## 💡 Ключевые преимущества метаданных

### 1. Организация
- Десятки проектов → легко найти нужный
- Теги → группировка по категориям
- Статус → фильтрация завершённых/активных

### 2. Поиск
- По описанию: "найти проект про турбо"
- По заказчику: "все проекты АвтоВАЗ"
- По тегам: "все гоночные проекты"

### 3. Контекст
- Сразу понятно о чём проект
- Не нужно открывать каждый файл
- Заметки помогают вспомнить детали

### 4. Профессиональный вид
- Карточки с описаниями выглядят современно
- Удобно показывать коллегам/заказчикам
- Легко ориентироваться в большом количестве проектов

---

## 🎯 MVP vs Полная версия

### MVP (Минимум для первой версии)

**Метаданные:**
- ✅ Описание проекта
- ✅ Теги
- ✅ Сохранение в localStorage (временно)

**UI:**
- ✅ Режим карточек (один режим)
- ✅ Поиск по всем полям
- ✅ Фильтр по тегам
- ✅ Диалог редактирования

### Полная версия

**Метаданные:**
- ✅ Всё из MVP
- ✅ Заказчик
- ✅ Статус
- ✅ Заметки
- ✅ Цвет метки
- ✅ Сохранение в JSON файлы

**UI:**
- ✅ Всё из MVP
- ✅ Режим списка (второй режим)
- ✅ Фильтр по статусу
- ✅ Сортировка по всем полям

**Дополнительно (опционально):**
- История изменений проекта
- Избранное (звёздочка ⭐)
- Последние открытые
- Экспорт/импорт метаданных

---

## ✅ Итого

**Добавление метаданных проектов решает ключевую проблему:**

❌ **Было:** Десятки файлов с непонятными названиями → трудно найти нужный  
✅ **Стало:** Карточки с описаниями → сразу понятно о чём каждый проект

**Основные фичи:**
1. Описание, заказчик, теги, заметки, статус
2. Поиск по всем полям метаданных
3. Фильтры (теги, статус)
4. Два режима просмотра (карточки + список)
5. Сохранение в JSON файлы (переносимо)

**Готово к передаче Claude Code!** 🚀